{% extends "base.html" %}
{% load widget_tweaks %}
{% block content %}
<div class="container">
<div id="form-type" data-form-type="{{is_edit}}"></div>
<form id="form" method="post" class="componente-form" enctype="multipart/form-data">
  {% csrf_token %}
  <h3>
    <strong>Estruturação dos Componentes</strong>
  </h3>
  <h5>
    <strong>2.1 Estruturação e implementação da Secretaria de Cultura ou órgão equivalente
      (Secretaria em conjunto com outras políticas, fundação de cultura, departamento, coordenação, diretoria, etc)</strong>
  </h5>

  <div class="form-group">
    <label for="{{ form.data_publicacao.id_for_label }}">
      Data da Publicação do Ato Normativo relativo a criação do Órgão Gestor
    </label>
    {% if form.sistema.orgao_gestor.situacao != 2 %}
      {% render_field form.data_publicacao class="form-control date half-width" %}
    {% else %}
       {% render_field form.data_publicacao disabled="disabled" class="form-control date half-width" %}
    {% endif %}
  </div>

  <div class="form-group">
    <label for="{{ form.arquivo.id_for_label }}">
      Comprovação de criação do órgão gestor
    </label>
    {% if form.arquivo.value %}
    <p><a href="{{ form.arquivo.value.url }}" target="_blank">Baixar arquivo atual</a></p>
    {% if form.sistema.orgao_gestor.situacao != 2 %}
    <p>Modificar: {% render_field form.arquivo %}</p>
    {% endif %}
    {% else %}
    <p>{% render_field form.arquivo %}</p>
    {% endif %}
  </div>

  <div class="form-group">
    <label for="{{ form.perfil.id_for_label }}">
      Qual o perfil do órgão gestor de cultura?
    </label>
    {% render_field form.perfil class="form-control" %}
  </div>
  </br>

  <div class="form-group">
    <label for="{{ form.possui_cnpj.id_for_label }}">
       O Orgão Gestor de Cultura possui CNPJ?</br>
    </label>
    {% if form.sistema.fundo_cultura.comprovante_cnpj.situacao != 2 %}
      {% render_field form.possui_cnpj class="radio" value="true" %}
    {% else %}
      {% render_field form.possui_cnpj disabled="disabled" class="radio" %}
    {% endif %}
  </div>

  <div id="cnpj_form">
    <div class="form-group {% if form.cnpj.errors %} has-error {% endif %}">
      <label for="{{ form.cnpj.id_for_label }}" class="col-sm-12">
        CNPJ
      </label>
      {% if form.sistema.fundo_cultura.comprovante_cnpj.situacao != 2 %}
        {% render_field form.cnpj class="form-control cnpj half-width" %}
      {% else %}
        {% render_field form.cnpj disabled="disabled" class="form-control cnpj half-width" %}
      {% endif %}
    </div>

    <div class="form-group">
      <label for="{{ form.comprovante.id_for_label }}">
        Comprovante do CNPJ
      </label>
      {% if form.comprovante.value %}
        <p><a href="{{ form.comprovante.value.url }}" target="_blank">Baixar arquivo atual</a></p>
        {% if form.sistema.sistema.fundo_cultura.comprovante.situacao != 2 %}
          <p>Modificar: {% render_field form.comprovante %}</p>
        {% endif %}
      {% else %}
        <p>{% render_field form.comprovante %}</p>
      {% endif %}
    </div>
    <label for="{{ form.comprovante.id_for_label }}">
        Banco
    </label>
        {% render_field form.banco class="form-control" %}
    <br/>
    <label for="{{ form.comprovante.id_for_label }}">
        Agência
    </label>
        {% render_field form.agencia class="form-control date half-width" %}
    <br/>
    <label for="{{ form.comprovante.id_for_label }}">
        Conta Corrente com dígito
    </label>
        {% render_field form.conta class="form-control date half-width" %}
    <br/>
  </div>

  <div>

  </div>


  <div class="alert alert-info" role="alert">
    <strong>Para execução, sugerimos as seguintes atividades:</strong><br>
    - Elaborar minuta;<br>
    - Discutir e consultar a sociedade civil (através de seminários, reuniões com entidade civil, audiências, etc);<br>
    - Encaminhar para análise jurídica;<br>
    - Encaminhar ao governador/prefeito para aprovação;<br>
    - Encaminhar ao Poder Legislativo.<br>
    <strong>Observação:&nbsp</strong><br>
    - Manuais disponiveis no site: <a href="http://portalsnc.cultura.gov.br/manuais/"> http://portalsnc.cultura.gov.br/manuais/</a><br>
    - Componentes do Sistema: <a href="http://portalsnc.cultura.gov.br/sistemas-de-cultura/"> http://portalsnc.cultura.gov.br/sistemas-de-cultura/</a><br>
    <strong>Atenção, com as informações:</strong><br>
    - O CNPJ do Órgão Gestor deve ser diferente do CNPJ do ente federado.<br>
    - A conta bancária informada deve estar vinculada ao CNPJ do Órgão Gestor de Cultura<br>

  </div>

</form>
</div>

{% endblock content %}
{% block js %}

<script type="text/javascript">
  $(document).ready(function () {

    $('#form').submit(function(){
      $("#form :disabled").removeAttr('disabled');
    });

    var formularioComponente = $('form.componente-form');
    if ($('#form-type').data('form-type') === 'True'){
      formularioComponente.after(`
        <a type="button" id="botaoSalvarConfirmacao" class="btn btn-success">Salvar</a>
      `);
    } else {
      formularioComponente.after(`
        <button type="submit" id="botaoSalvar"class="btn btn-success">Salvar</button>
      `);
    }

    $('#botaoSalvarConfirmacao').on('click', () => {
      var confirmacao = confirm('Deseja mesmo alterar o arquivo? Isso poderá ocasionar o retrocesso do seu processo.');
      if (confirmacao == true) {
        formularioComponente.submit();
      }
    });
    $('#botaoSalvar').on('click', () => {
      formularioComponente.submit();
    });
    if($('#id_possui_cnpj_0').is(":checked")){
      $('#cnpj_form').css('display', 'block');
    }
    if($('#id_possui_cnpj_1').is(":checked")){
      $('#cnpj_form').css('display', 'none');
    }

    $('input[name=possui_cnpj]').change(function() {
      if(this.value=='True') {
        $('#cnpj_form').fadeIn();
      }
      else {
        $('#cnpj_form').fadeOut();
      }
    })

  });
</script>

{% endblock js %}
